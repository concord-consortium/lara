= render partial: 'runs/unauthorized_dialog'

- # This page is the 'completion page' for the activity. It has its own template.
- if @page.is_completion
  = render :partial => 'show_completion', :locals => {:page => @page, :layout => @page.layout}

- else
  - content_for :title do
    = @page.name || @page.lightweight_activity.name + ":#{@page.position}"

  .content-hdr
    %h2.h2
      = @page.lightweight_activity.name

  = render :partial => 'show', :locals => {:page => @page, :layout => @page.layout}

  .bottom-buttons
    - next_activity = @sequence.next_activity(@page.lightweight_activity) if @sequence
    - unless @page.first_visible?
      .button-left
        .last-page
          %a{ :href => runnable_activity_page_path(@page.lightweight_activity, @page.prev_visible_page), :class => 'prev' }
            %input{ :class => 'button', :type => 'submit', :value => t("BACK") }
    - if @page.last_visible?
      .button-center
        .submit.report
          %a{ :href => summary_with_response_path(@page.lightweight_activity, @session_key), :class => 'gen-report', :target => 'new' }
            %input{ :class => 'button', :type => 'submit', :value => t("GENERATE_A_REPORT") }
    - if @page.last_visible? && next_activity
      .button-right
        .next-page
          %a{ :href => sequence_activity_path(@sequence, next_activity), :title => next_activity.name, :class => 'next forward_nav'}
            %input{ :class => 'button next forward_nav', :type => 'submit', :value => t("BEGIN_NEXT_ACTIVITY") }
    - elsif @page.next_visible_page
      .button-right
        .next-page
          %a{ :href => runnable_activity_page_path(@page.lightweight_activity, @page.next_visible_page), :class => 'next forward_nav' }
            %input{ :class => 'button next forward_nav', :type => 'submit', :value => t("NEXT")}

-# Set Google Analytics content group based on the project. Note that project might be undefined
-# for activity, but defined for sequence. Always try to use sequence data first.
-# If @sequence is defined, it's a sequence run.
= render partial: "shared/analytics_content_group", locals: {resource: @sequence || @activity}