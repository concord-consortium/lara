= content_for :nav do
  .breadcrumbs
    %ul
      %li= link_to 'All Activities', activities_path
      %li= "/ #{@activity.name}".html_safe

%h1.title Edit activity
= form_for @activity, {:url => "/activities/#{@activity.id}", :method => 'put'} do |f|
  = f.error_messages
  = edit_menu_for(@activity, f)
  =# f.hidden_field 'investigation_id', :value =>@activity.investigation.id # LightweightActivities currently don't belong_to Investigations
  - if defined?(session[:user_id])
    = f.hidden_field 'user_id', :value => session[:user_id]
  = field_set_tag 'Activity Name' do
    = f.text_field :name
  = field_set_tag 'Publication status' do
    = f.select :publication_status, options_for_select(LightweightActivity::PUB_STATUSES, @activity.publication_status)
  = field_set_tag 'Activity Description' do
    = editable_field @activity, :description, { :use_trigger => true, :edit_string => 'Edit', :update_url => activity_path(@activity), :type => 'wysiwyg', :rows => 5, :cols => 55, :submit => 'Save', :cancel => 'Cancel', :onblur => 'ignore', :wysiwyg => { :controls => { :html => { :visible => true } } } }
  = field_set_tag 'Related Content' do
    = editable_field @activity, :related, { :use_trigger => true, :edit_string => 'Edit', :update_url => activity_path(@activity), :type => 'wysiwyg', :rows => 5, :cols => 55, :submit => 'Save', :cancel => 'Cancel', :onblur => 'ignore', :wysiwyg => { :controls => { :html => { :visible => true } } } }
=# javascript_tag("focus_first_field();");
#menu
  #pages
    %h2 Activity Pages
    %ul#sort-pages
      - @activity.pages.each do |p|
        %li{ :id => dom_id_for(p, :item), :class => 'item' }
          = p.name # TODO: Maybe put in "page #" here if it's blank; truncate title if it's too long and restore original width
          %ul.menu
            %li.edit= link_to "Edit", edit_activity_page_path(@activity, p)
            %li.run= link_to "Show", activity_page_path(@activity, p), :target => 'new'
            %li.delete= link_to "Delete", activity_page_path(@activity, p), method: :delete, data: { confirm: 'Are you sure?' }
            %li.drag_handle
              &nbsp;
      %li#add= link_to "Add Page", new_activity_page_path(@activity)
